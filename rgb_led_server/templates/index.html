<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RGB LED Controller</title>

    <!-- Link the CSS file -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>

    <!-- Header section -->
    <header>
        <h1>Raspberry Pi RGB LED Controller</h1>
        <p>Control and monitor hardware from a web interface</p>
    </header>

    <!-- Main content -->
    <main>
        <section class="content">

            <h2>LED Controls</h2>

            <!-- Toggle button -->
            <button onclick="toggleLED()">Toggle LED</button>

            <br><br>

            <!-- RGB sliders -->
            <label>Red</label><br>
            <input type="range" id="r" min="0" max="255" value="0"><br><br>

            <label>Green</label><br>
            <input type="range" id="g" min="0" max="255" value="0"><br><br>

            <label>Blue</label><br>
            <input type="range" id="b" min="0" max="255" value="0"><br><br>

            <!-- Set color button -->
            <button onclick="setColor()">Set Color</button>

            <!-- LED Status -->
            <p id="status">LED status: unknown</p>

            <hr>

            <!-- Temperature from Luke's Pi -->
            <h2>Temperature (Luke’s Pi)</h2>
            <p id="luke-temp">-- °C</p>

        </section>
    </main>

    <!-- JavaScript -->
    <script>
        const TEMP_API_URL = "http://192.168.68.72:5000/api/sensor";

        // Toggle LED
        function toggleLED() {
            fetch("/api/toggle", { method: "POST" })
                .then(res => res.json())
                .then(data => {
                    document.getElementById("status").innerText =
                        data.on ? "LED ON" : "LED OFF";
                });
        }

        // Set RGB color
        function setColor() {
            const r = document.getElementById("r").value;
            const g = document.getElementById("g").value;
            const b = document.getElementById("b").value;

            fetch("/api/color", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ r, g, b })
            })
            .then(res => res.json())
            .then(() => {
                document.getElementById("status").innerText =
                    `LED Color: R${r} G${g} B${b}`;
            });
        }

        // Get LED status on load
        function fetchLedStatus() {
            fetch("/api/status")
                .then(res => res.json())
                .then(data => {
                    document.getElementById("status").innerText =
                        data.on ? "LED ON" : "LED OFF";
                });
        }

        // Fetch Luke’s temperature
       async function fetchLukeTemperature() {
        
    try {
        const response = await fetch(TEMP_API_URL);

        if (!response.ok) 
        {throw new Error("Network response was not ok");}

        const data = await response.json();
        document.getElementById("luke-temp").innerText =data.temperature + " °C";} 
        
        catch (error) {
        console.error("Failed to fetch Luke's temperature:", error);
        document.getElementById("luke-temp").innerText = "Unavailable";
    }
}

        

        // Run on page load
        window.onload = function () {
            fetchLedStatus();
            fetchLukeTemperature();
            setInterval(fetchLukeTemperature, 1000);
        };
    </script>

    <!-- Footer -->
    <footer>
        <p>© 2026 RGB Controller</p>
    </footer>

</body>
</html>
